#################################
Fragment Molecular Orbital Method
#################################

The fragment molecular orbital (FMO) method is arguably one of the most 
established methods in the field of fragment-based methods. The main purpose of
this page is to describe the FMO method, and how the method has developed. 

*******
Origins
*******

.. |I| replace:: :math:`I`
.. |J| replace:: :math:`J`
.. |IJ| replace:: :math:`IJ`

PIMO
====

The FMO method arguably got its start as the pair interaction molecular orbital
(PIMO) method :cite:t:`Kitaura1999a`. In the original paper, for a system split 
into :math:`N` disjoint fragments, the Hamiltonian for the |I|-th fragment 
is written as:

.. math::
   \widehat{H}_I = \widehat{H}_I^0 + \sum_{J=1; J\neq I}^N\widehat{V}^I_{J}

where :math:`\widehat{H}_I^0` is the Hamiltonian of the |I|-th fragment 
and :math:`\widehat{V}^I_{J}` is the interaction of |I| with :math:`J`. 
:math:`\widehat{V}_{IJ}` is given by :ref:`density_embedding`. The PIMO method
considers up to two-body terms, with the Hamiltonian of dimer |IJ| given
by:

.. math::
   \widehat{H}_{IJ} = \widehat{H}_{IJ}^0 + 
                      \sum_{K=1; K\neq J\neq I}^N\widehat{V}^{IJ}_{K}

Analogous to the monomer Hamiltonians, :math:`\widehat{H}_{IJ}^0` is the 
Hamiltonian of the |IJ|-th dimer and :math:`\widehat{V}^{IJ}_{K}` is the 
interaction of dimer |IJ| with fragment :math:`K`. Fragment densities are
converged at the one-body level and used as is in two-body terms.

Initial applications of PIMO looked at interaction energies of water trimers and 
tetramers. At the HF/6-31G** level of theory PIMO differed from supersystem
interactions by about 0.1 kcal/mol.

FMO99
=====

That same year, FMO proper was introduced :cite:t:`Kitaura1999`. Physically the
equations of FMO are the same as PIMO. The difference between FMO and PIMO is
conceptual and has to do with the fragment orbitals. In PIMO each fragment was a
closed-shell molecule, and the intial guess orbitals are simply obtained by
running the isolated closed-shell molecule. In FMO, the initial orbitals for
fragment |I| are generated by:

- creating a reference system for fragment |I|,
- localizing the orbitals of the reference system to the atoms in |I|,
- discarding contributions to the orbitals from atoms outside of |I|, and then
- renormalizing the orbitals.

How to fragment the system was briefly considered for ethanol; initial results
showed the final accuarcy was quite sensitive to fragment choice (differing by
up to 7 kcal/mol). The only suggestion was to not make the fragments too small.
Additional calculations on propane, propanol, and methylacetamide further served
as a proof-of-principles for FMO. All calculations were done using SCF/STO-3G.

FMO00
=====

Shortly after introducing the original FMO procedure, the capping procedure was
overhauled. The new FMO00 capping procedure no longer requires reference systems
to obtain the initial densities. Instead, the electrons in a bond are assigned
to one of the two atoms. Assuming the two bonded fragments are |I| and |J|, we
further assume |I| gets the electrons. In this case, the equations for |J| are 
solved normally, whereas the equations for |I| are solved with a basis set
that includes part of the valence space of |J| (specifically the part from the
bonded atom).

Also notable about this FMO incarnation is that it introduced a screening 
method. The FMO00 screening procedure relies on distance cutoffs (based on the
shortest inter-atomic distance) to approximate the two-body interactions in some
dimers. The dimer interactions for distant dimers are not neglected, rather they
are approximated using the one-body densities.

All initial calculations used the SCF/STO-3G model. Application of FMO00 to 
propane showed that the error in the total energy (relative to the traditional
calculation) decreased relative to FMO99. This study also applied FMO00 was to 
peptides. For the peptides the fragment size was again considered. Results were 
markedly better when there are two amino acids in a fragment vs. one (maximum 
error in the total energy decreased from 8.9 kcal/mol to around 1 kcal/mol). 
Relative energies of the peptides had a maximum error of about 1.5 kcal/mol. 

FMO02
=====

The next incarnation of FMO introduced approimations to the embedding method. In
traditional density embedding, monomer |I| interacts with the density of each
monomer |J|. This amounts to a term analogous to the Coulomb build in SCF, but 
with the density of |J|. Like it's SCF brethern, the computational complexity of 
this terms scale as :math:`\mathcal{O}(N^4)`. To reduce the cost of the 
embedding, the :ref:`fmo02_embedding` method :cite:t:`Nakano2002`: was 
introduced. As a proof-of-concept, the study considered applications to proteins
using the HF/STO-3G method. Errors, were similar to the FMO00 method, but 
results were obtained significantly faster.


FMO04 (Three-Body FMO)
======================

The next development in FMO was an extension capable of handeling three-body
terms :cite:t:`Fedorov2004a`. This required introducing a screening method for
three body terms, *i.e.*, :ref:`fmo04_screening`, and also introduced a new
capping method, :ref:`fmo04_capping`, which is essentially a combination of the
:ref:`fmo99_capping` and :ref:`fmo00_capping` methods. Three-body results 
focused on water clusters and peptides with the SCF method and the STO-3G, 
3-21G, 6-31G\*, and 6-31++G\*\* basis sets. Notably this study was one of the
first to show that FMO performs best with small basis sets, postulating that
this is because of the lack of exchange and intramolecular basis set 
superposition error.


*******
Summary
*******


+-------+-----------+-------------------+-------+-----------+
| Name  | Fragments | Embedding         | Caps  | Screening |
+=======+===========+===================+=======+===========+
| PIMO  | Cluster   | One-body density  | N/A   | N/A       |
+-------+-----------+-------------------+-------+-----------+
| FMO99 | N/A       | One-body density  | FMO99 | N/A       |
+-------+-----------+-------------------+-------+-----------+
| FMO00 | N/A       | One-body density  | FMO00 | FMO00     |
+-------+-----------+-------------------+-------+-----------+
| FMO02 | N/A       | FMO02             | FMO00 | FMO00     |
+-------+-----------+-------------------+-------+-----------+
| FMO04 | N/A       | FMO02             | FMO04 | FMO04     |
+-------+-----------+-------------------+-------+-----------+

*********************
Other FMO Development
*********************

Initial, approximate gradients for the FMO00 method were published in 2001 
:cite:t:`Kitaura_2001`. This formulation neglected the coupled-perturbed 
Hartree-Fock contribution to the gradient, which is necessary because the 
densities are not obtained variationally.

:cite:t:`Inadomi_2002` detailed a mechanism for retrieving orbital energies and
densities from FMO.

:cite:t:`Sekino2003` used FMO to approximate a DFT calculation, PW91/STO-3G.
Also considered were the HOMO/LUMO energies, dipole moment, and quadrupole 
moment of the systems. Systems considered were water-ammonia clusters and DNA. 
Errors in energies were on the order of a millihartree, multipole moments 
matched to within a few tenths (units were not specified). A follow up paper
:cite:t:`Sugiki_2003` used DIIS to accelerate the convergence of the iterative
charge procedure.

:cite:t:`Komeiji2003` used FMO to perform a molecular dynamics simulation of a
peptide at the HF/STO-3G level of theory.

:cite:t:`Fedorov2004b` discussions about distributed computing of FMO with 
GAMESS. Presensts some SCF/6-31G* and SCF/STO-3G calculations of large water
clusters.

:cite:t:`Mochizuki2004` used the SCF orbitals from an FMO calculation to do MP2.
Also considered in this study were MP2 densities and partially renormalized MP2.
Calculations used the 6-31G basis set and focused on a large water cluster and
several proteins.